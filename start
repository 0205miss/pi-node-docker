# starting postgres
/etc/init.d/postgresql start

# wait for postgres to start
# https://github.com/docker/docker/issues/7445#issuecomment-150318533

su -c "
	export PGPASSWORD=postgres
    while ! psql --host=localhost --username=postgres > /dev/null 2>&1; do
        echo 'Waiting for postgres to start...'
        sleep 1;
    done;
echo 'postgres started!';"

# stellar-core
stellar-core --newdb --forcescp
stellar-core &

export STELLAR_CORE_URL="http://localhost:8080"
export STELLAR_CORE_DATABASE_URL="postgres://postgres:postgres@localhost/stellar?sslmode=disable"
export DATABASE_URL="postgres://postgres:postgres@localhost/horizon_development?sslmode=disable"
export INGEST=true

# horizon
cd horizon-v0.5.0-linux-amd64
./horizon db init
./horizon db migrate up
./horizon --port 8000 --per-hour-rate-limit 72000 &

while true; do sleep 1000; done
